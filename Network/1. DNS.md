# DNS

## 1. DNS(Domain Name System)란?
- DNS는 도메인 이름을 IP 주소로 변환해주는 시스템
### 1.1 주요 특징 
- 분산 구조형 데이터 베이스: 전 세계적으로 분산된 서버들이 협력
- 트리 구조의 도메인 네임 체계: 계층적 구조로 효율적
- 인터넷 핵심 인프라: DNS 문제 시 인터넷 전체 마비 가능성
### 1.1 구조 예시
`www.naver.com`의 경우:
- www: 호스트 네임(서브 도메인)
- naver.com: 도메인 네임
  
## 2. IP 변환 과정
- hosts 파일에 정적으로 설정한 정보가 있는지 확인 후 있으면 그것을 씀
- 로컬 DNS 캐시를 확인
- 캐시에 없다면 DNS 서버에 질의
- DNS 서버는 정보가 있으면 반환하고, 없으면 상위 DNS 서버에게 질의하여 ip 주소 반환
- 도메인에 해당하는 ip를 캐시에 추가
  
### 2.1 로컬 DNS 서버
- 사용자가 naver.com 입력
- 먼저 캐시된 DNS 정보 확인
- 없으면 ISP의 로컬 DNS 서버에 재귀 쿼리(Recursive Query) 전송
> 재귀 쿼리(Recursive Query): '사용자(DNS 클라이언트) → 로컬 DNS 서버' 구간에 해당(최종 결과 요청)
### 2.2 루트 DNS 서버(.com)
- 해당 도메인의 IP 주소가 없다면, 로컬 DNS 서버가 가장 최상위 계층인 루트 DNS 서버에 반복 쿼리(Iterative Query) 전송
- 로컬 DNS 서버에 '.com'을 담당하는 TLD DNS 서버 주소를 응답
### 2.3 TLD DNS 서버 (Top-Level Domain DNS Server)
- 로컬 DNS 서버는 루트 서버로부터 받은 TLD DNS 서버 주소로 다시 'naver.com'의 ip 주소를 질의하는 반복 쿼리를 보냄
- TLD 서버는 '.com' 도메인 내에서 'naver'를 담당하는 도메인 네임 서버(Domain Name Server)의 주소 응답
### 2.4 권한 있는 네임 서버(Authoritative Name Server)
- 로컬 DNS 서버는 최종적으로 권한 있는 네임 서버에 'www.naver.com'의 ip 주소를 질의하는 반복 쿼리를 보냄
- 권한 있는 네임 서버는 자신의 데이터베이스에서 'www.naver.com'에 해당하는 최종 ip 주소를 찾아 로컬 DNS 서버에 응답

## 3. DNS 프로토콜 특징
- OSI 7계층 프로토콜
- 전송 프로토콜

| 상황 | 사용 프로토콜 | 이유 |
|------|---------------|------|
| **일반 DNS 쿼리** | UDP | 단순한 요청-응답, 낮은 오버헤드 |
| **대용량 응답** (512바이트 초과) | TCP | 신뢰성 필요 |
| **영역 전송** (Zone Transfer) | TCP | 데이터 무결성 중요 |
> 영역 전송: DNS 서버간 질의

## 4. 쿼리 특징

### Recursive Query (재귀 쿼리)
- **클라이언트 → 로컬 DNS 서버**
- 클라이언트는 최종 결과만 기다림
- 로컬 DNS 서버가 모든 과정 처리

### Iterative Query (반복 쿼리)
- **로컬 DNS 서버 → 다른 DNS 서버들**
- 각 서버는 다음 단계 정보만 제공
- 로컬 DNS 서버가 직접 탐색 진행

## 5. 레코드 타입
| 레코드 타입 | 목적 | 예시 |
|-------------|------|------|
| **A** | 도메인 → IPv4 주소 매핑 | `example.com → 192.168.1.1` |
| **AAAA** | 도메인 → IPv6 주소 매핑 | `example.com → 2001:db8::1` |
| **CNAME** | 도메인 별칭 설정 | `blog.example.com → pages.example.com` |


## 6. 로드밸런싱 중 DNS Round Robin
DNS 라운드 로빈은 단일 도메인에 대해 여러 개의 ip 주소를 등록하고, DNS 서버가 요청이 올 때마다 그 ip 주소들을 순차적으로(라운드 로빈) 응답하는 방식
- 별도의 장비 없이 dns 서버의 설정만드로 구현할 수 있음

### 단점
#### 1. 공인 IP 주소의 필요성</br>
서버 대수를 늘리려면 그만큼의 공인 IP 주소가 필요

#### 2. DNS 캐싱으로 인해 균등하게 분산되지 않을 수 있음</br>
한번 특정 IP를 응답받아 캐싱한 사용자는 TTL(Time-To-Live) 값이 만료되기 전까지는 항상 같은 서버로 접속

#### 3. 서버 상태 확인 불가
DNS 서버는 웹 서버의 실제 상태(다운 여부, 부하량 등)를 알지 못함
  - 사용자는 다운된 서버의 IP를 응답받아 접속에 실패하는 경우가 발생
  - 가용성을 보장하지 못함

### 보완
클라우드 서비스에서 다양한 DNS 부하 분산 기능을 지원함
- 가중치 라운드 로빈 (WRR) : 각 서버에 처리 능력에 따른 가중치를 부여하고 가중치에 비례하여 트래픽을 분산
- Least connection: 접속 클라이언트 수가 가장 적은 서버를 선택
  - 로드밸런서에서 실시간으로 connection 수를 관리하거나 각 서버에서 주기적으로 알려주는 것이 필요
  
